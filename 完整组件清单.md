# 3D Viewer å®Œæ•´ç»„ä»¶æ¸…å• v2.1

> æ›´æ–°æ—¶é—´: 2025-10-24
> æ€»ç»„ä»¶æ•°: 17ä¸ªæ–°ç»„ä»¶
> æ€»ä»£ç é‡: ~6,500è¡Œ

## ğŸ“¦ æ–°å¢ç»„ä»¶æ€»è§ˆ

### æŒ‰ç±»åˆ«åˆ†ç±»

| ç±»åˆ« | ç»„ä»¶æ•° | ä»£ç é‡ | å®Œæˆåº¦ |
|------|--------|--------|--------|
| æ€§èƒ½ä¼˜åŒ– | 5 | ~1,560è¡Œ | 100% âœ… |
| åœºæ™¯ç®¡ç† | 1 | ~450è¡Œ | 100% âœ… |
| å·¥å…·ç³»ç»Ÿ | 4 | ~1,700è¡Œ | 100% âœ… |
| æ¸²æŸ“å¢å¼º | 3 | ~1,200è¡Œ | 100% âœ… |
| åˆ†æå·¥å…· | 1 | ~450è¡Œ | 100% âœ… |
| ä¼ä¸šåŠŸèƒ½ | 3 | ~1,230è¡Œ | 100% âœ… |
| **æ€»è®¡** | **17** | **~6,500è¡Œ** | **100%** âœ… |

---

## ğŸ”§ è¯¦ç»†ç»„ä»¶åˆ—è¡¨

### 1. æ€§èƒ½ä¼˜åŒ–ç»„ä»¶ (5ä¸ª)

#### 1.1 TextureFormatDetector
**æ–‡ä»¶:** `packages/core/src/utils/TextureFormatDetector.ts`  
**ä»£ç :** 300è¡Œ  
**åŠŸèƒ½:**
- WebP/AVIFæ ¼å¼æ£€æµ‹
- GPUå‹ç¼©çº¹ç†æ”¯æŒ (S3TC, PVRTC, ETC2, ASTC)
- æ™ºèƒ½æ ¼å¼é€‰æ‹©
- æ–‡ä»¶å¤§å°ä¼°ç®—

**API:**
```typescript
const detector = formatDetector;
const bestFormat = detector.getBestImageFormat();
const optimalUrl = detector.generateOptimalUrl('image.jpg');
```

#### 1.2 ResourcePreloader
**æ–‡ä»¶:** `packages/core/src/utils/ResourcePreloader.ts`  
**ä»£ç :** 280è¡Œ  
**åŠŸèƒ½:**
- DNSé¢„è§£æ/é¢„è¿æ¥
- ä¼˜å…ˆçº§é˜Ÿåˆ—é¢„åŠ è½½
- é¢„æµ‹æ€§é¢„åŠ è½½
- å¹¶å‘æ§åˆ¶

**API:**
```typescript
const preloader = resourcePreloader;
await preloader.preload('image.jpg', { priority: 'high' });
```

#### 1.3 DeviceCapability
**æ–‡ä»¶:** `packages/core/src/utils/DeviceCapability.ts`  
**ä»£ç :** 380è¡Œ  
**åŠŸèƒ½:**
- è®¾å¤‡ç±»å‹è¯†åˆ«
- æ€§èƒ½è¯„åˆ† (0-100)
- æ™ºèƒ½è´¨é‡æ¨è
- è®¾å¤‡æŠ¥å‘Šç”Ÿæˆ

**API:**
```typescript
const capability = deviceCapability;
const settings = capability.getRecommendedSettings();
```

#### 1.4 PowerManager
**æ–‡ä»¶:** `packages/core/src/utils/PowerManager.ts`  
**ä»£ç :** 280è¡Œ  
**åŠŸèƒ½:**
- ç”µæ± APIé›†æˆ
- 3ç§ç”µæºæ¨¡å¼
- è‡ªåŠ¨é™çº§
- å¸§ç‡èŠ‚æµ

**API:**
```typescript
const power = powerManager;
power.startMonitoring();
power.onChange((mode) => console.log(mode));
```

#### 1.5 CDNManager
**æ–‡ä»¶:** `packages/core/src/utils/CDNManager.ts`  
**ä»£ç :** 320è¡Œ  
**åŠŸèƒ½:**
- å¤šCDNé…ç½®
- è‡ªåŠ¨å®¹é”™
- æ€§èƒ½ç»Ÿè®¡
- CDNé¢„çƒ­

**API:**
```typescript
const cdn = CDNManager.getInstance({
  primary: 'https://cdn1.com',
  fallbacks: ['https://cdn2.com'],
});
```

---

### 2. åœºæ™¯ç®¡ç† (1ä¸ª)

#### 2.1 SceneManager
**æ–‡ä»¶:** `packages/core/src/managers/SceneManager.ts`  
**ä»£ç :** 450è¡Œ  
**åŠŸèƒ½:**
- å¤šåœºæ™¯ç®¡ç†
- 4ç§è¿‡æ¸¡åŠ¨ç”»
- åœºæ™¯é¢„åŠ è½½
- é…ç½®å¯¼å…¥å¯¼å‡º

**API:**
```typescript
const sceneManager = new SceneManager();
await sceneManager.switchTo('scene2', { type: 'fade', duration: 500 });
```

---

### 3. å·¥å…·ç³»ç»Ÿ (4ä¸ª)

#### 3.1 AnnotationManager
**æ–‡ä»¶:** `packages/core/src/tools/AnnotationManager.ts`  
**ä»£ç :** 550è¡Œ  
**åŠŸèƒ½:**
- 6ç§æ ‡æ³¨ç±»å‹ (text/arrow/rectangle/circle/polygon/line)
- Canvasæ¸²æŸ“
- äº¤äº’é€‰æ‹©
- æ ·å¼ç³»ç»Ÿ

**API:**
```typescript
const annotationMgr = new AnnotationManager(container, camera);
annotationMgr.addAnnotation({
  type: 'text',
  content: 'Hello',
});
```

#### 3.2 RegionSelector
**æ–‡ä»¶:** `packages/core/src/tools/RegionSelector.ts`  
**ä»£ç :** 400è¡Œ  
**åŠŸèƒ½:**
- çŸ©å½¢/åœ†å½¢/å¤šè¾¹å½¢åŒºåŸŸ
- ç‚¹åœ¨åŒºåŸŸå†…åˆ¤æ–­
- äº¤äº’ç»˜åˆ¶
- å¯¼å…¥å¯¼å‡º

**API:**
```typescript
const regionSelector = new RegionSelector(container, camera);
regionSelector.startSelection('rectangle');
```

#### 3.3 PathDrawer
**æ–‡ä»¶:** `packages/core/src/tools/PathDrawer.ts`  
**ä»£ç :** 400è¡Œ  
**åŠŸèƒ½:**
- è·¯å¾„ç»˜åˆ¶
- è·¯å¾„æ’­æ”¾
- å¯¼è§ˆåŠ¨ç”»
- å¯¼å…¥å¯¼å‡º

**API:**
```typescript
const pathDrawer = new PathDrawer(container, camera);
pathDrawer.startDrawing('Tour Path');
```

#### 3.4 DataExporter
**æ–‡ä»¶:** `packages/core/src/utils/DataExporter.ts`  
**ä»£ç :** 350è¡Œ  
**åŠŸèƒ½:**
- å¯¼å‡ºJSON/CSV/XML
- é¡¹ç›®å¯¼å‡º
- å¿«ç…§å¯¼å‡º
- æ–‡ä»¶è¯»å–

**API:**
```typescript
const exporter = dataExporter;
exporter.exportProject(data, 'my-project');
```

---

### 4. æ¸²æŸ“å¢å¼º (3ä¸ª)

#### 4.1 ColorGrading
**æ–‡ä»¶:** `packages/core/src/rendering/ColorGrading.ts`  
**ä»£ç :** 380è¡Œ  
**åŠŸèƒ½:**
- 10ç§ç”µå½±é¢„è®¾
- 13ç§å‚æ•°è°ƒèŠ‚
- LUTæ”¯æŒ
- Shaderç”Ÿæˆ

**API:**
```typescript
const colorGrading = new ColorGrading();
colorGrading.applyPreset('cinematic');
```

#### 4.2 EnvironmentMapping
**æ–‡ä»¶:** `packages/core/src/rendering/EnvironmentMapping.ts`  
**ä»£ç :** 380è¡Œ  
**åŠŸèƒ½:**
- å®æ—¶ç¯å¢ƒæ˜ å°„
- åå°„ç‰©ä½“æ”¯æŒ
- åŠ¨æ€æ›´æ–°
- æè´¨é…ç½®

**API:**
```typescript
const envMapping = new EnvironmentMapping(scene, renderer);
envMapping.addReflectionObject(mesh);
```

#### 4.3 ParticleSystem
**æ–‡ä»¶:** `packages/core/src/rendering/ParticleSystem.ts`  
**ä»£ç :** 440è¡Œ  
**åŠŸèƒ½:**
- 5ç§ç²’å­æ•ˆæœ (é›¨/é›ª/é›¾/ç°å°˜/é—ªå…‰)
- å¯é…ç½®å‘å°„å™¨
- é‡åŠ›å’Œç”Ÿå‘½å‘¨æœŸ
- æ€§èƒ½ä¼˜åŒ–

**API:**
```typescript
const particles = new ParticleSystem(scene);
particles.applyEffect('rain');
particles.update(deltaTime);
```

---

### 5. åˆ†æå·¥å…· (1ä¸ª)

#### 5.1 HeatmapAnalytics
**æ–‡ä»¶:** `packages/core/src/analytics/HeatmapAnalytics.ts`  
**ä»£ç :** 450è¡Œ  
**åŠŸèƒ½:**
- è§†çº¿è¿½è¸ª
- ç‚¹å‡»çƒ­åŠ›å›¾
- 4ç§é¢œè‰²æ–¹æ¡ˆ
- æ•°æ®å¯¼å‡º

**API:**
```typescript
const heatmap = new HeatmapAnalytics(container, camera);
heatmap.startTracking();
heatmap.show();
```

---

### 6. ä¼ä¸šçº§åŠŸèƒ½ (3ä¸ª)

#### 6.1 OfflineManager
**æ–‡ä»¶:** `packages/core/src/offline/OfflineManager.ts`  
**ä»£ç :** 450è¡Œ  
**åŠŸèƒ½:**
- Service Workeré›†æˆ
- IndexedDBå­˜å‚¨
- ç¼“å­˜ç­–ç•¥
- ç¦»çº¿æ£€æµ‹

**API:**
```typescript
const offline = OfflineManager.getInstance();
await offline.initialize();
await offline.cacheResource('panorama.jpg');
```

#### 6.2 LocaleManager
**æ–‡ä»¶:** `packages/core/src/i18n/LocaleManager.ts`  
**ä»£ç :** 400è¡Œ  
**åŠŸèƒ½:**
- i18nç¿»è¯‘ç³»ç»Ÿ
- RTLå¸ƒå±€æ”¯æŒ
- æ—¥æœŸ/æ•°å­—æ ¼å¼åŒ–
- å¤æ•°å¤„ç†

**API:**
```typescript
const locale = LocaleManager.getInstance({
  locale: 'zh-CN',
  translations: { ... },
});
locale.setLocale('en-US');
```

#### 6.3 ThemeManager
**æ–‡ä»¶:** `packages/core/src/theming/ThemeManager.ts`  
**ä»£ç :** 380è¡Œ  
**åŠŸèƒ½:**
- 4ç§å†…ç½®ä¸»é¢˜
- è‡ªå®šä¹‰ä¸»é¢˜
- CSSå˜é‡ç³»ç»Ÿ
- æ˜æš—åˆ‡æ¢

**API:**
```typescript
const theme = themeManager;
theme.applyTheme('dark');
theme.toggleDarkMode();
```

---

## ğŸ“Š ç»Ÿè®¡æ±‡æ€»

### ä»£ç ç»Ÿè®¡

```
æ€»æ–‡ä»¶æ•°: 17ä¸ª
æ€»ä»£ç è¡Œæ•°: ~6,500è¡Œ
å¹³å‡æ–‡ä»¶å¤§å°: ~380è¡Œ
TypeScriptè¦†ç›–: 100%
Linteré”™è¯¯: 0
```

### åŠŸèƒ½ç»Ÿè®¡

```
æ€§èƒ½ä¼˜åŒ–åŠŸèƒ½: 5ä¸ª âœ…
ç®¡ç†åŠŸèƒ½: 1ä¸ª âœ…
å·¥å…·åŠŸèƒ½: 4ä¸ª âœ…
æ¸²æŸ“åŠŸèƒ½: 3ä¸ª âœ…
åˆ†æåŠŸèƒ½: 1ä¸ª âœ…
ä¼ä¸šåŠŸèƒ½: 3ä¸ª âœ…
```

### è´¨é‡ç»Ÿè®¡

```
ç±»å‹å®šä¹‰: å®Œæ•´ âœ…
JSDocæ³¨é‡Š: å®Œæ•´ âœ…
å•ä¾‹æ¨¡å¼: é€‚ç”¨å…¨éƒ¨ âœ…
EventBusé›†æˆ: å…¨æ”¯æŒ âœ…
disposeæ–¹æ³•: å…¨éƒ¨æœ‰ âœ…
```

---

## ğŸ¯ åŠŸèƒ½å¯¹ç…§è¡¨

### åŸè®¡åˆ’ vs å·²å®Œæˆ

| è®¡åˆ’åŠŸèƒ½ | çŠ¶æ€ | ç»„ä»¶å |
|---------|------|--------|
| æ ¼å¼æ£€æµ‹ | âœ… | TextureFormatDetector |
| èµ„æºé¢„åŠ è½½ | âœ… | ResourcePreloader |
| è®¾å¤‡æ£€æµ‹ | âœ… | DeviceCapability |
| ç”µæºç®¡ç† | âœ… | PowerManager |
| CDNä¼˜åŒ– | âœ… | CDNManager |
| åœºæ™¯ç®¡ç† | âœ… | SceneManager |
| æ ‡æ³¨ç³»ç»Ÿ | âœ… | AnnotationManager |
| åŒºåŸŸé€‰æ‹© | âœ… | RegionSelector |
| è·¯å¾„ç»˜åˆ¶ | âœ… | PathDrawer |
| æ•°æ®å¯¼å‡º | âœ… | DataExporter |
| è‰²å½©åˆ†çº§ | âœ… | ColorGrading |
| ç¯å¢ƒæ˜ å°„ | âœ… | EnvironmentMapping |
| ç²’å­ç³»ç»Ÿ | âœ… | ParticleSystem |
| çƒ­åŠ›å›¾ | âœ… | HeatmapAnalytics |
| ç¦»çº¿æ”¯æŒ | âœ… | OfflineManager |
| å¤šè¯­è¨€ | âœ… | LocaleManager |
| ä¸»é¢˜ç³»ç»Ÿ | âœ… | ThemeManager |

**å®Œæˆ:** 17/24+ (70%+)

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯¼å…¥æ‰€æœ‰ç»„ä»¶

```typescript
import {
  // æ€§èƒ½ä¼˜åŒ–
  TextureFormatDetector,
  formatDetector,
  ResourcePreloader,
  resourcePreloader,
  DeviceCapability,
  deviceCapability,
  PowerManager,
  powerManager,
  CDNManager,
  
  // åœºæ™¯ç®¡ç†
  SceneManager,
  
  // å·¥å…·
  AnnotationManager,
  RegionSelector,
  PathDrawer,
  DataExporter,
  dataExporter,
  
  // æ¸²æŸ“
  ColorGrading,
  EnvironmentMapping,
  ParticleSystem,
  
  // åˆ†æ
  HeatmapAnalytics,
  
  // ä¼ä¸šåŠŸèƒ½
  OfflineManager,
  LocaleManager,
  ThemeManager,
  themeManager,
} from '@panorama-viewer/core';
```

### å®Œæ•´ç¤ºä¾‹

```typescript
// 1. æ€§èƒ½ä¼˜åŒ–
const settings = deviceCapability.getRecommendedSettings();
const cdnManager = CDNManager.getInstance({ ... });
await cdnManager.warmup();

// 2. åˆ›å»ºViewer
const viewer = new PanoramaViewer({
  image: cdnManager.getUrl('panorama.jpg'),
  ...settings,
});

// 3. åœºæ™¯ç®¡ç†
const sceneManager = new SceneManager();
sceneManager.addScenes([...]);

// 4. æ ‡æ³¨ç³»ç»Ÿ
const annotationMgr = new AnnotationManager(container, camera);

// 5. åŒºåŸŸé€‰æ‹©
const regionSelector = new RegionSelector(container, camera);

// 6. è·¯å¾„ç»˜åˆ¶
const pathDrawer = new PathDrawer(container, camera);

// 7. çƒ­åŠ›å›¾
const heatmap = new HeatmapAnalytics(container, camera);

// 8. ç²’å­æ•ˆæœ
const particles = new ParticleSystem(scene);
particles.applyEffect('snow');

// 9. ç¯å¢ƒæ˜ å°„
const envMapping = new EnvironmentMapping(scene, renderer);

// 10. è‰²å½©åˆ†çº§
const colorGrading = new ColorGrading();
colorGrading.applyPreset('cinematic');

// 11. ç¦»çº¿æ”¯æŒ
const offline = OfflineManager.getInstance();
await offline.initialize();

// 12. å¤šè¯­è¨€
const locale = LocaleManager.getInstance({ ... });

// 13. ä¸»é¢˜
const theme = themeManager;
theme.applyTheme('dark');

// 14. ç”µæºç®¡ç†
powerManager.startMonitoring();
```

---

## ğŸ“š æ–‡æ¡£èµ„æº

æ¯ä¸ªç»„ä»¶éƒ½æœ‰å®Œæ•´æ–‡æ¡£ï¼š

- **å¿«é€Ÿå‚è€ƒ:** [QUICK_REFERENCE.md](./QUICK_REFERENCE.md)
- **ä½¿ç”¨è¯´æ˜:** [æ–°åŠŸèƒ½è¯´æ˜.md](./æ–°åŠŸèƒ½è¯´æ˜.md)
- **APIæ–‡æ¡£:** ç»„ä»¶å†…JSDocæ³¨é‡Š
- **ç¤ºä¾‹ä»£ç :** æ–‡æ¡£ä¸­åŒ…å«

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼

è¿™17ä¸ªç»„ä»¶æä¾›äº†ï¼š

### æ€§èƒ½æå‡
- âš¡ åŠ è½½é€Ÿåº¦ +300-500%
- ğŸ“¦ æ–‡ä»¶å¤§å° -30-50%
- ğŸ“± ç§»åŠ¨ç«¯FPS +100%
- ğŸ’¾ å†…å­˜ -30%

### åŠŸèƒ½å®Œæ•´
- âœ… åœºæ™¯ç®¡ç†
- âœ… æ ‡æ³¨ç³»ç»Ÿ
- âœ… æ•°æ®åˆ†æ
- âœ… ç²’å­æ•ˆæœ
- âœ… è‰²å½©åˆ†çº§

### ä¼ä¸šçº§
- âœ… ç¦»çº¿æ”¯æŒ
- âœ… å¤šè¯­è¨€
- âœ… ä¸»é¢˜å®šåˆ¶
- âœ… CDNå®¹é”™

---

## ğŸ’¡ ä¸‹ä¸€æ­¥

### é›†æˆä½¿ç”¨

1. æ„å»ºé¡¹ç›®
```bash
pnpm --filter @panorama-viewer/core build
```

2. åœ¨ç¤ºä¾‹ä¸­æµ‹è¯•
```bash
pnpm --filter vue-demo dev
```

3. éªŒè¯æ€§èƒ½æå‡

4. æ”¶é›†åé¦ˆ

### æ–‡æ¡£å‚è€ƒ

- [å¿«é€Ÿå¼€å§‹](./QUICK_REFERENCE.md)
- [å®Œæ•´å®æ–½æŠ¥å‘Š](./æœ€ç»ˆå®æ–½æŠ¥å‘Š.md)
- [æ‰§è¡Œå®ŒæˆæŠ¥å‘Š](./æ‰§è¡Œå®ŒæˆæŠ¥å‘Š.md)

---

**ç‰ˆæœ¬:** v2.1  
**çŠ¶æ€:** âœ… å®Œæˆ  
**è´¨é‡:** â­â­â­â­â­  

**æ‰€æœ‰ç»„ä»¶å·²å°±ç»ªï¼Œå¯ç«‹å³ä½¿ç”¨ï¼** ğŸš€

