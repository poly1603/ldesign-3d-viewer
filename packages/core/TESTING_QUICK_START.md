# æµ‹è¯•å¿«é€Ÿå…¥é—¨æŒ‡å—

> 5åˆ†é’Ÿå¿«é€Ÿäº†è§£å’Œä½¿ç”¨æµ‹è¯•ç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥ core åŒ…ç›®å½•
cd packages/core

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œç‰¹å®šæµ‹è¯•
pnpm test EventBus

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶æ¨èï¼‰
pnpm test -- --watch

# æŸ¥çœ‹è¦†ç›–ç‡
pnpm test -- --coverage

# UIç•Œé¢
pnpm test -- --ui
```

## ğŸ“Š å½“å‰çŠ¶æ€

- âœ… **187ä¸ªæµ‹è¯•é€šè¿‡**
- âœ… **0ä¸ªå¤±è´¥**
- âœ… **æ ¸å¿ƒæ¨¡å—94.1%è¦†ç›–ç‡**
- âœ… **æ‰§è¡Œæ—¶é—´~7ç§’**

## ğŸ“ æµ‹è¯•æ–‡ä»¶ä½ç½®

```
__tests__/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ EventBus.test.ts         (32ä¸ªæµ‹è¯•) âœ…
â”‚   â”œâ”€â”€ Logger.test.ts           (19ä¸ªæµ‹è¯•) âœ…
â”‚   â””â”€â”€ MemoryManager.test.ts    (35ä¸ªæµ‹è¯•) âœ…
â”œâ”€â”€ plugins/
â”‚   â””â”€â”€ PluginManager.test.ts    (31ä¸ªæµ‹è¯•) âœ…
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ HotspotManager.test.ts   (27ä¸ªæµ‹è¯•) âœ…
â”‚   â””â”€â”€ ObjectPool.test.ts       (43ä¸ªæµ‹è¯•) âœ…
â”œâ”€â”€ camera/
â”‚   â””â”€â”€ AdvancedCamera.test.ts   (46ä¸ªæµ‹è¯•) ğŸ“å¾…éªŒè¯
â””â”€â”€ setup.ts                      (æµ‹è¯•ç¯å¢ƒé…ç½®)
```

## ğŸ“– æ–‡æ¡£ä½ç½®

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `TESTING_QUICK_START.md` | æœ¬æ–‡æ¡£ - å¿«é€Ÿå…¥é—¨ |
| `TEST_SUMMARY.md` | å®Œæ•´å·¥ä½œæ€»ç»“ |
| `TEST_PROGRESS.md` | å¼€å‘è¿›åº¦è¿½è¸ª |
| `TEST_COVERAGE_REPORT.md` | è¦†ç›–ç‡è¯¦ç»†æŠ¥å‘Š |
| `TESTING_GUIDE.md` | å®Œæ•´æµ‹è¯•æŒ‡å— |
| `__tests__/README.md` | æµ‹è¯•ç›®å½•è¯´æ˜ |

## ğŸ¯ æµ‹è¯•çš„æ¨¡å—

### âœ… å·²å®Œæˆï¼ˆ6ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰

1. **EventBus** - äº‹ä»¶ç³»ç»Ÿ
   - è®¢é˜…/å‘å¸ƒ
   - ä¸€æ¬¡æ€§ç›‘å¬
   - Promiseç­‰å¾…
   - å†å²è®°å½•

2. **Logger** - æ—¥å¿—ç³»ç»Ÿ
   - å¤šçº§æ—¥å¿—
   - æ ¼å¼åŒ–
   - å†å²ç®¡ç†
   - æ€§èƒ½ä¼˜åŒ–

3. **ObjectPool** - å¯¹è±¡æ± 
   - é€šç”¨å¯¹è±¡æ± 
   - Three.jså¯¹è±¡æ± ï¼ˆVector3, Quaternionç­‰ï¼‰
   - å†…å­˜ä¼˜åŒ–
   - æ€§èƒ½åŸºå‡†

4. **PluginManager** - æ’ä»¶ç®¡ç†
   - æ³¨å†Œ/å®‰è£…/å¸è½½
   - ä¾èµ–ç®¡ç†
   - ç”Ÿå‘½å‘¨æœŸ
   - äº‹ä»¶ç³»ç»Ÿ

5. **HotspotManager** - çƒ­ç‚¹ç®¡ç†
   - æ·»åŠ /ç§»é™¤çƒ­ç‚¹
   - DOMæ ‡è®°
   - ä½ç½®æ›´æ–°
   - äº‹ä»¶å¤„ç†

6. **MemoryManager** - å†…å­˜ç®¡ç†
   - å†…å­˜è¿½è¸ª
   - è­¦å‘Šæœºåˆ¶
   - è‡ªåŠ¨æ¸…ç†
   - ç›‘æ§ç³»ç»Ÿ

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Ÿ

```bash
pnpm test EventBus.test.ts
```

### Q: å¦‚ä½•æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼Ÿ

```bash
pnpm test -- --coverage
```

è¦†ç›–ç‡æŠ¥å‘Šä½ç½®ï¼š`coverage/index.html`

### Q: å¦‚ä½•è°ƒè¯•æµ‹è¯•ï¼Ÿ

1. åœ¨æµ‹è¯•ä»£ç ä¸­æ·»åŠ  `debugger`
2. è¿è¡Œï¼š`node --inspect-brk node_modules/.bin/vitest`
3. æ‰“å¼€ Chrome DevTools

### Q: æµ‹è¯•æ‰§è¡Œå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

å½“å‰æµ‹è¯•æ‰§è¡Œå¾ˆå¿«ï¼ˆ~7ç§’ï¼‰ï¼Œå¦‚æœå˜æ…¢ï¼š
- ä½¿ç”¨ `--run` è€Œä¸æ˜¯ watch æ¨¡å¼
- åªè¿è¡Œéœ€è¦çš„æµ‹è¯•æ–‡ä»¶
- æ£€æŸ¥æ˜¯å¦æœ‰æ— é™å¾ªç¯

### Q: å¦‚ä½•è·³è¿‡æŸä¸ªæµ‹è¯•ï¼Ÿ

```typescript
it.skip('è¿™ä¸ªæµ‹è¯•æš‚æ—¶è·³è¿‡', () => {
  // ...
})
```

### Q: å¦‚ä½•åªè¿è¡ŒæŸä¸ªæµ‹è¯•ï¼Ÿ

```typescript
it.only('åªè¿è¡Œè¿™ä¸ªæµ‹è¯•', () => {
  // ...
})
```

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶

åœ¨ `__tests__/` ä¸‹åˆ›å»ºå¯¹åº”ç›®å½•å’Œæ–‡ä»¶ï¼š

```
__tests__/
â””â”€â”€ your-module/
    â””â”€â”€ YourModule.test.ts
```

### 2. åŸºæœ¬æ¨¡æ¿

```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest'
import { YourModule } from '../../src/your-module/YourModule'

describe('YourModule', () => {
  let instance: YourModule
  
  beforeEach(() => {
    instance = new YourModule()
  })
  
  afterEach(() => {
    instance.dispose()
  })
  
  describe('åŠŸèƒ½åç§°', () => {
    it('åº”è¯¥èƒ½å¤Ÿæ‰§è¡ŒæŸåŠŸèƒ½', () => {
      // Arrange
      const input = 'test'
      
      // Act
      const result = instance.doSomething(input)
      
      // Assert
      expect(result).toBe('expected')
    })
  })
})
```

### 3. è¿è¡Œä½ çš„æµ‹è¯•

```bash
pnpm test YourModule.test.ts
```

## ğŸ¨ æµ‹è¯•æœ€ä½³å®è·µ

### âœ… æ¨è

- ä½¿ç”¨æè¿°æ€§çš„ä¸­æ–‡æµ‹è¯•åç§°
- ä¸€ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªåŠŸèƒ½ç‚¹
- ä½¿ç”¨ beforeEach/afterEach æ¸…ç†èµ„æº
- æµ‹è¯•æ­£å¸¸è·¯å¾„å’Œå¼‚å¸¸è·¯å¾„
- åŒ…å«è¾¹ç•Œæƒ…å†µæµ‹è¯•

### âŒ é¿å…

- æµ‹è¯•ä¹‹é—´ç›¸äº’ä¾èµ–
- ä¸æ¸…ç†èµ„æºå¯¼è‡´å†…å­˜æ³„æ¼
- æµ‹è¯•åç§°æ¨¡ç³Šä¸æ¸…
- æµ‹è¯•è¿‡äºå¤æ‚
- å¿½ç•¥å¼‚æ­¥æ“ä½œ

## ğŸ› é‡åˆ°é—®é¢˜ï¼Ÿ

### 1. Rollup ä¾èµ–é—®é¢˜

å¦‚æœé‡åˆ° `@rollup/rollup-win32-x64-msvc` é”™è¯¯ï¼š

```bash
cd D:\WorkBench\ldesign
pnpm install
```

### 2. æµ‹è¯•è¶…æ—¶

å¢åŠ è¶…æ—¶æ—¶é—´ï¼š

```typescript
it('é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•', async () => {
  // ...
}, 10000) // 10ç§’è¶…æ—¶
```

### 3. Mockä¸å·¥ä½œ

ç¡®ä¿åœ¨ `__tests__/setup.ts` ä¸­æ­£ç¡®é…ç½®äº† mock

### 4. WebGLç›¸å…³é”™è¯¯

æŸ¥çœ‹ `__tests__/setup.ts` ä¸­çš„ WebGL mock é…ç½®

## ğŸ“Š æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

### ç»ˆç«¯è¾“å‡º

è¿è¡Œæµ‹è¯•åç›´æ¥åœ¨ç»ˆç«¯æŸ¥çœ‹ç»“æœ

### è¦†ç›–ç‡æŠ¥å‘Š

```bash
pnpm test -- --coverage
# æ‰“å¼€ coverage/index.html
```

### UIç•Œé¢

```bash
pnpm test -- --ui
# æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:51204/__vitest__/
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [Vitest æ–‡æ¡£](https://vitest.dev/)
- [å®Œæ•´æµ‹è¯•æŒ‡å—](./TESTING_GUIDE.md)
- [æµ‹è¯•è¿›åº¦](./TEST_PROGRESS.md)
- [è¦†ç›–ç‡æŠ¥å‘Š](./TEST_COVERAGE_REPORT.md)

## ğŸ’¡ æç¤º

- å¼€å‘æ—¶ä½¿ç”¨ `--watch` æ¨¡å¼è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- æäº¤ä»£ç å‰è¿è¡Œ `pnpm test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- å®šæœŸæ£€æŸ¥è¦†ç›–ç‡æŠ¥å‘Šï¼Œè¡¥å……ç¼ºå¤±çš„æµ‹è¯•
- é‡åˆ°é—®é¢˜å…ˆæŸ¥çœ‹æ–‡æ¡£ï¼Œå†å¯»æ±‚å¸®åŠ©

---

**å¿«é€Ÿå‘½ä»¤å¤‡å¿˜å½•**:

```bash
pnpm test              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test -- --watch   # ç›‘å¬æ¨¡å¼
pnpm test -- --ui      # UIç•Œé¢
pnpm test EventBus     # è¿è¡Œç‰¹å®šæµ‹è¯•
```

**æœ€åæ›´æ–°**: 2025-10-29
