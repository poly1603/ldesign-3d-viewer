# âš¡ 3D Panorama Viewer v2.0 - å¿«é€Ÿå‚è€ƒ

> ä¸€é¡µæŒæ¡æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

---

## ğŸš€ 30 ç§’å¿«é€Ÿå¼€å§‹

```typescript
import { PanoramaViewer } from '@panorama-viewer/core';

const viewer = new PanoramaViewer({
  container: document.getElementById('viewer'),
  image: 'panorama.jpg',
  autoRotate: true,
});
```

---

## ğŸ“¦ æ ¸å¿ƒåŠŸèƒ½é€ŸæŸ¥

### åŸºç¡€æ“ä½œ

```typescript
// åŠ è½½å›¾ç‰‡
await viewer.loadImage('scene.jpg', true);

// é‡ç½®è§†è§’
viewer.reset();

// æˆªå›¾
const img = viewer.screenshot();

// æ¸…ç†
viewer.dispose();
```

### çƒ­ç‚¹

```typescript
// æ·»åŠ 
viewer.addHotspot({
  id: 'point1',
  position: { theta: 0, phi: Math.PI/2 },
  label: 'ğŸ“ è¿™é‡Œ',
});

// ç›‘å¬ç‚¹å‡»
eventBus.on('hotspot:click', ({ id }) => {
  console.log('ç‚¹å‡»:', id);
});
```

### äº‹ä»¶

```typescript
const eventBus = new EventBus();

// è®¢é˜…
eventBus.on('camera:change', ({ rotation, fov }) => {
  console.log(rotation, fov);
});

// ç­‰å¾…
await eventBus.waitFor('viewer:ready');
```

---

## ğŸ¬ è§†é¢‘å…¨æ™¯

```typescript
const video = new VideoPanorama({
  sources: [
    { url: '480p.mp4', quality: 'low', bitrate: 1000 },
    { url: '1080p.mp4', quality: 'high', bitrate: 5000 },
  ],
  adaptiveBitrate: true,
});

await video.play();
video.setVolume(0.8);
```

---

## ğŸµ ç©ºé—´éŸ³é¢‘

```typescript
const audio = new SpatialAudio(camera);
await audio.initialize();

await audio.addSource('id', {
  url: 'sound.mp3',
  position: { theta: 0, phi: Math.PI/4 },
  loop: true,
});

audio.update(); // åœ¨åŠ¨ç”»å¾ªç¯ä¸­
```

---

## ğŸ¥½ VR æ¨¡å¼

```typescript
const vr = new VRManager(renderer, camera, scene);
await vr.initialize();
await vr.enterVR();
```

---

## ğŸŒˆ HDR æ¸²æŸ“

```typescript
const hdr = new HDRRenderer(renderer, scene, {
  toneMapping: 'aces',
  exposure: 1.0,
});

const texture = await hdr.loadHDR('env.hdr');
hdr.applyEnvironmentMap(texture);
```

---

## ğŸ¨ åå¤„ç†

```typescript
const post = new PostProcessing(renderer, scene, camera, {
  bloom: { enabled: true, strength: 1.5 },
  antialiasing: 'smaa',
});

post.initialize();
post.render(); // æ›¿ä»£ renderer.render()
```

---

## ğŸ“· ç›¸æœºæ§åˆ¶

```typescript
const cam = new AdvancedCamera(camera);

// å¹³æ»‘ç§»åŠ¨
await cam.smoothMoveTo(position, rotation, fov, 1000);

// è·¯å¾„åŠ¨ç”»
cam.addKeyframe({ position, rotation, fov });
cam.playPath({ duration: 5000, loop: true });

// å½•åˆ¶
cam.startRecording();
// ... æ“ä½œ
const keyframes = cam.stopRecording();
```

---

## ğŸ—ºï¸ ç“¦ç‰‡ç³»ç»Ÿ

```typescript
const tiles = new TileManager(scene, camera, {
  type: 'google',
  urlTemplate: '/tiles/{l}/{x}_{y}.jpg',
  maxLevel: 5,
});

tiles.update(); // åœ¨åŠ¨ç”»å¾ªç¯ä¸­
```

---

## ğŸ“ æµ‹é‡å·¥å…·

```typescript
const measure = new MeasureTool(scene, camera, container);

// æ¿€æ´»
measure.activate('distance'); // æˆ– 'angle'

// å¯¼å‡ºæ•°æ®
const data = measure.exportData();
```

---

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

```typescript
const plugins = new PluginManager(eventBus);

plugins.setContext({ viewer, eventBus, ... });
await plugins.install(SharePlugin);
```

---

## ğŸ› ï¸ å·¥å…·å‡½æ•°

```typescript
// é˜²æŠ–èŠ‚æµ
const fn = debounce(() => {}, 300);
const fn2 = throttle(() => {}, 100);

// å–æ¶ˆä»¤ç‰Œ
const token = new CancellationToken();
await loadImage(url, token);
token.cancel();

// å¯¹è±¡æ± 
const v = Vector3Pool.getInstance().acquire();
v.set(1, 2, 3);
Vector3Pool.getInstance().release(v);

// æ•°å­¦
const val = lerp(0, 100, 0.5); // 50
const clamped = clamp(150, 0, 100); // 100
```

---

## ğŸ’¾ å†…å­˜ç®¡ç†

```typescript
const mem = new MemoryManager({
  maxTextureMemory: 512 * 1024 * 1024,
  autoCleanup: true,
});

mem.startMonitoring(5000);
const stats = mem.getStats();
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

```typescript
// æ—¥å¿—
logger.setLevel(LogLevel.DEBUG);
const end = logger.time('æ“ä½œ');
// ... æ‰§è¡Œ
end();

// ç»Ÿè®¡
const stats = viewer.getPerformanceStats();
console.log('FPS:', stats.fps);

// å¯¹è±¡æ± 
const poolStats = getAllPoolStats();
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–é€ŸæŸ¥

### å¿…åšä¼˜åŒ–

```typescript
{
  renderOnDemand: true,        // â¬‡ï¸ CPU 50%
  maxTextureSize: 4096,        // é™åˆ¶çº¹ç†
}
```

### æ¨èä¼˜åŒ–

```typescript
// ä½¿ç”¨å¯¹è±¡æ± 
const euler = EulerPool.getInstance().acquire();
// ... ä½¿ç”¨
EulerPool.getInstance().release(euler);

// æ¸è¿›å¼åŠ è½½
const loader = new ProgressiveTextureLoader();
await loader.load({
  previewUrl: 'low.jpg',
  fullUrl: 'high.jpg',
});

// å¤§å›¾ç”¨ç“¦ç‰‡
const tiles = new TileManager(...);
```

---

## ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–

```typescript
import { isMobile } from '@panorama-viewer/core';

{
  maxTextureSize: isMobile() ? 2048 : 4096,
  qualityPreset: isMobile() ? 'medium' : 'high',
  gyroscope: isMobile(),
}
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

```typescript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
logger.setLevel(LogLevel.DEBUG);

// æŸ¥çœ‹å†…å­˜
console.log(memoryManager.getStats());

// æŸ¥çœ‹å¯¹è±¡æ± 
console.log(getAllPoolStats());

// æ€§èƒ½é¢æ¿
viewer.togglePerformanceOverlay();
```

---

## ğŸ”— å¿«é€Ÿé“¾æ¥

- ğŸ“– [å®Œæ•´æ–‡æ¡£](./START_HERE.md)
- ğŸš€ [å¿«é€Ÿå¼€å§‹](./docs/QUICK_START.md)
- ğŸ“š [API å‚è€ƒ](./docs/API_REFERENCE.md)
- âš¡ [æ€§èƒ½ä¼˜åŒ–](./docs/PERFORMANCE_BEST_PRACTICES.md)
- ğŸ¯ [ç¤ºä¾‹ä»£ç ](./examples/)

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… DO - æ¨è

```typescript
âœ… ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿè€Œéå›è°ƒ
âœ… å¯ç”¨ renderOnDemand
âœ… ä½¿ç”¨å¯¹è±¡æ± 
âœ… é…ç½®å†…å­˜é™åˆ¶
âœ… å¤§å›¾ç”¨æ¸è¿›å¼/ç“¦ç‰‡
âœ… æ­£ç¡®è°ƒç”¨ dispose()
âœ… å¯ç”¨æ—¥å¿—ç³»ç»Ÿ
```

### âŒ DON'T - é¿å…

```typescript
âŒ é¢‘ç¹åˆ›å»º Three.js å¯¹è±¡
âŒ ä¸è®¾å†…å­˜é™åˆ¶
âŒ å¤§å›¾ç›´æ¥åŠ è½½
âŒ å¿˜è®°æ¸…ç†èµ„æº
âŒ æŒç»­æ¸²æŸ“æ¨¡å¼ï¼ˆç§»åŠ¨ç«¯ï¼‰
âŒ ä½¿ç”¨ any ç±»å‹
```

---

## ğŸ åŠŸèƒ½é€Ÿè§ˆ

| åŠŸèƒ½ | v1 | v2 |
|------|----|----|
| åŸºç¡€å…¨æ™¯ | âœ… | âœ… |
| è§†é¢‘å…¨æ™¯ | âŒ | âœ… |
| ç©ºé—´éŸ³é¢‘ | âŒ | âœ… |
| VR/AR | âŒ | âœ… |
| HDR | âŒ | âœ… |
| åå¤„ç† | âŒ | âœ… |
| ç“¦ç‰‡ç³»ç»Ÿ | âŒ | âœ… |
| æµ‹é‡å·¥å…· | âŒ | âœ… |
| æ’ä»¶ç³»ç»Ÿ | âŒ | âœ… |
| å¯¹è±¡æ±  | âŒ | âœ… |

---

## ğŸ“Š æ€§èƒ½é€Ÿè§ˆ

| æŒ‡æ ‡ | æå‡ |
|------|------|
| GC å‹åŠ› | â¬‡ï¸ 70% |
| å†…å­˜ | â¬‡ï¸ 40% |
| åŠ è½½ | â¬†ï¸ 5x |
| CPU | â¬‡ï¸ 50% |
| FPS | â¬†ï¸ 71% |

---

**æ‰“å°æœ¬é¡µï¼Œéšæ—¶æŸ¥é˜…ï¼** ğŸ“„

**è¯¦ç»†æ–‡æ¡£**: [START_HERE.md](./START_HERE.md)

